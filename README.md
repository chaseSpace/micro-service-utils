# Micro service utils

### 代码工程管理建议
-   ① 整个工程在一个git/svn仓库进行管理，而不是一个服务一个仓库；协议(protocol)使用git submodule的方式管理，便于与前端(web/移动端)协同开发
-   ② 在单仓库下，每个服务分目录管理，建立一个专门的目录存放所有的协议代码(如pb.go文件)，并在.gitignore中忽略这个目录
-   ③ 使用统一的服务级别的init()方法，以及全局长生命周期对象（如db_conn, global_cfg等）及其生命周期管理方法(func)
-   ④ 统一的build_*.sh
-   ⑤ 创建新的服务目录时，必须使用已经写好的模板，按需创建子目录，避免非必需的“垃圾”代码
-   ⑥ 严谨的Code Review流程
-   ⑦ （可选）最好采用CI/CD流程
-   ⑧ 各种服务上线脚本（如代码、SQL等）存放在各服务的目录下，这个不要统一存放
-   ⑨ main文件应存放在各服务根目录下，并且根据情况最好有`README.md`以及项目特定的文档


对部分建议的解释: 

 ① 一个服务一个仓库带来的弊端是: 
-   不能统一管理依赖的第三方库的版本，会有潜在隐患
-   不能统一管理服务代码的布局，一定程度上降低协同开发效率
-   分仓库导致【拉取依赖服务代码】这一更新操作的成本略微增加（需指定pkg进行更新），增加出错几率，降低人拉取欲望，久而久之，各仓库会充斥大量的重复代码（util/common方法），且实现不一
-   不方便统一管理配置
-   (开发习惯上)需要打开多个IDE窗口，并在之间切换，这是很繁琐的操作

单仓库模式带来的好处是：
-   整个项目布局一目了然，比如服务数量，目录结构
-   (开发习惯上)一个IDE窗口开发所有服务

单仓库模式的潜在问题：
-   当服务数量达到30个以上时，整个工程在打开时能会加载过久，并且IDE占用内存较高，开发效率会开始降低；
建议是开始建立一个新仓库，迁移大部分通用代码到新仓库，按业务特点给新仓库命名，团队分小组，由组长管理新仓库。
事实上，达到此规模时，开发团队的人员应该也不少了，也需要在人员架构上分组管理。